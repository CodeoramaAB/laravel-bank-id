<?php

namespace Jgroup\BankID\Tests;

use Jgroup\BankID\Facades\BankID;
use Jgroup\BankID\Rules\SignCompleted;
use Jgroup\BankID\RpApi\Models\CompletionData;
use Jgroup\BankID\RpApi\Models\CollectResponse;
use Jgroup\BankID\Service\Models\BankIDTransaction;

class SignCompleteTest extends TestCase
{
    protected $signature =
        'PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PFNpZ25hdHVyZSB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI+PFNpZ25lZEluZm8geG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPjxDYW5vbmljYWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvVFIvMjAwMS9SRUMteG1sLWMxNG4tMjAwMTAzMTUiPjwvQ2Fub25pY2FsaXphdGlvbk1ldGhvZD48U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxkc2lnLW1vcmUjcnNhLXNoYTI1NiI+PC9TaWduYXR1cmVNZXRob2Q+PFJlZmVyZW5jZSBUeXBlPSJodHRwOi8vd3d3LmJhbmtpZC5jb20vc2lnbmF0dXJlL3YxLjAuMC90eXBlcyIgVVJJPSIjYmlkU2lnbmVkRGF0YSI+PFRyYW5zZm9ybXM+PFRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnL1RSLzIwMDEvUkVDLXhtbC1jMTRuLTIwMDEwMzE1Ij48L1RyYW5zZm9ybT48L1RyYW5zZm9ybXM+PERpZ2VzdE1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZW5jI3NoYTI1NiI+PC9EaWdlc3RNZXRob2Q+PERpZ2VzdFZhbHVlPlJEVHVqTFo2ZHkyK3hiaUk1aEg0WlJPeHhMbHZVY0lVckxEajRTRjVYZUE9PC9EaWdlc3RWYWx1ZT48L1JlZmVyZW5jZT48UmVmZXJlbmNlIFVSST0iI2JpZEtleUluZm8iPjxUcmFuc2Zvcm1zPjxUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy9UUi8yMDAxL1JFQy14bWwtYzE0bi0yMDAxMDMxNSI+PC9UcmFuc2Zvcm0+PC9UcmFuc2Zvcm1zPjxEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyNzaGEyNTYiPjwvRGlnZXN0TWV0aG9kPjxEaWdlc3RWYWx1ZT5XVGw5Zlc0NFRELzA0MHlOZ2h5MnlRNWZXeUgzZ29JNGFYd1R2Um1vVnlBPTwvRGlnZXN0VmFsdWU+PC9SZWZlcmVuY2U+PC9TaWduZWRJbmZvPjxTaWduYXR1cmVWYWx1ZT5mY3MzZm45RjQyZDJGYk96S3FpYVdvWjF1UGtVSU9JYmh6SytsU2owVE9HRHJoNW11MGZ4SXhJbHQvanI4NkxGaVhjbHVsN3N3Y3dxYk1CYXU5NGpKbmJNby9oMjBmS2ZPY0IxTStaNmswamtMYlFlOS8zdktqZVMzYXJHdnFXNTFIVVpwOFVnOXlKWEFucVNTTkV5TXQ5VWE5TmtrUHhJemw1aFRBbkFOTkZyMms1cjZMdldiYnhpWitJeVdGZWl3UG5semhQeEpmdmNQMExySDJxZW50M3lnV1diMFd0dTVtMVd6RFBoL2pGUy9TamRrMlQzUlhTNmhFOW1TaVh6WDYxU1I3QUNwZnlCV3IzY2I0UFp5ZlFDVVVBWVlBbFgyeFRGV3hFenVvdHJuaXpMYXh4eHBuUysvSGwxeVpYY012UjJLUm4ybGpPd0dZMjZBYU12OGc9PTwvU2lnbmF0dXJlVmFsdWU+PEtleUluZm8geG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiIElkPSJiaWRLZXlJbmZvIj48WDUwOURhdGE+PFg1MDlDZXJ0aWZpY2F0ZT5NSUlGWURDQ0EwaWdBd0lCQWdJSUh2V01SUnBUNnNrd0RRWUpLb1pJaHZjTkFRRUxCUUF3ZURFTE1Ba0dBMVVFQmhNQ1UwVXhIVEFiQmdOVkJBb01GRlJsYzNSaVlXNXJJRUVnUVVJZ0tIQjFZbXdwTVJVd0V3WURWUVFGRXd3eE1URXhNVEV4TVRFeE1URXhNekF4QmdOVkJBTU1LbFJsYzNSaVlXNXJJRUVnUTNWemRHOXRaWElnUTBFeElIWXhJR1p2Y2lCQ1lXNXJTVVFnVkdWemREQWVGdzB5TWpBNU1USXlNakF3TURCYUZ3MHlNekE1TVRNeU1UVTVOVGxhTUlIQk1Rc3dDUVlEVlFRR0V3SlRSVEVkTUJzR0ExVUVDZ3dVVkdWemRHSmhibXNnUVNCQlFpQW9jSFZpYkNreEV6QVJCZ05WQkFRTUNsUnZiSFpoYm5OemIyNHhEekFOQmdOVkJDb01CbFJ2YkhaaGJqRVZNQk1HQTFVRUJSTU1NVGt4TWpFeU1USXhNakV5TVRvd09BWURWUVFwRERFb01qSXdPVEV6SURBNExqTXpLU0JVYjJ4MllXNGdWRzlzZG1GdWMzTnZiaUF0SUVKaGJtdEpSQ0J3dzZVZ1ptbHNNUm93R0FZRFZRUUREQkZVYjJ4MllXNGdWRzlzZG1GdWMzTnZiakNDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFQTmFldkdLVW5yc20yMkFVaVd6UDd0M2JsQ0RJbEdpUHhmRDhvd2NpRFlDaU5rRVBUTlpiekRNVVk2Q0pmZ2ZOa24xaUw4OUhMQ0J2WFpDVVRYMlRzMklJV2ZiL2ZrM2NsUHR3V1MvSEtUWlhJMEJaT3gxdU1YVCtPOXZ6aUlMdkhoRklpelFkSkJqOGpoTHhXYi9EbGFRRGNSMWZLanIwZFp4aFlzQkF0dEo1eHN6T2E3WE5neTRjU0o4WnRid3M3VHFrRlR3bzJCankzdTA4UmFzKzNaQUZwcHpWb1hubUs4TE15QTkyNnhYOHNPZHA3QVNFUGI0eHdpb3RhOVY4ZTdEQlV0OENiTG13SmhkcFkwbHZNTVBKUDYwVXNTbk13NUJMNC96WDJQc0hURE16aFBFOGtHS0d0VXZrOGNPRlFieE92eE1VN0dWa1pIWS9yMENhSWtDQXdFQUFhT0JvekNCb0RBN0JnZ3JCZ0VGQlFjQkFRUXZNQzB3S3dZSUt3WUJCUVVITUFHR0gyaDBkSEE2THk5MFpYTjBMbkpsZG05allYUnBiMjV6ZEdGMGRYTXVjMlV3RVFZRFZSMGdCQW93Q0RBR0JnUXFBd1FGTUE0R0ExVWREd0VCL3dRRUF3SUhnREFmQmdOVkhTTUVHREFXZ0JSZ2VuMm5XWU9NbjZTeEYrb05RME9WUSthWi9UQWRCZ05WSFE0RUZnUVVnVXVPTytFMHozNDNZdHFGUE4yTFl5QU1pVll3RFFZSktvWklodmNOQVFFTEJRQURnZ0lCQUN4cFlKdnovUVVzTzUrQXRjaHN2aUtHNWpiUkJqN2tqRUxOcmUxV2EyOU9IK1ZxSHFTaEhzUlg5SDlVK0xpbG81NGhXcUxhTTFyWTV5OFAzWU5FS3VXbHpvZS9sQlpCVTF3K2V3clYwRjk2UmRKUDZncGVUZVVLeG0zRFlTeFdldDJsZkJVMHhkT21LdFF6OENPUnBYL09RajNmR3ppRlgzdlIxeDREdVIxcm9sdjIwSlIxTGE3QjMrMXhpTUNpUXdQKzBsOGZLaDA3L1h4RFJQMUpwM3paQ2Z5NTNZazdHN3R3eXgzck5XR0l6MXQ2VG9MTmFWK1NBNlJwcTdDN3dzdjE3YXM5Tnh6Vk1oZEZxaHdzaDBKWlFabVhMZkJUazE5Z3pDNllvbHpMZ0hmTmhaem9oNmEzSTBNTWlhUjVoYXM3TnYrWms3VFFZaGRienlYRTI1UW1MUi9ZTmVJWEpNUk5aY2x1WFJzU3JzbUlhbGtBQ0tVNTh5bGJyQW0rTDBVRlJxRGFUZlVzTUlXcWVkK0U4SHhRbjVZQTl1NDlSTXVGR3o3SlB6SmlyREhpRUhpc3ZSQlNZZjhma2pqbGVWRktMQTYySEcrNUdMTGtNY0pmZUZJNXpkd3NybjFwdU1qM2REUXFOUy95MDhOb09PaDArWmYyRHdxdzRhZVpHaDNYSm1ralFrOGFubTIxV2lvcFI1MXNmSSt5dmFwaWNXdGlUZVRkbGJmQSsraXdLd3FvcU9UcXhPbXlIa1V1Q09VK3I3RFVPb2gzY2Y4aVlGRU5VbHBqNmJCTDRvdytsZEUyOCtFUnpsQzVCcFlFczlKZGtxZUFBaDg1TmZ1SjgyMEFFTm8wTDQvSm9RSG12OTB4aGVBUm1jTlo4b2hTTWJVbjMxSjRpM0QwPC9YNTA5Q2VydGlmaWNhdGU+PFg1MDlDZXJ0aWZpY2F0ZT5NSUlGM2pDQ0E4YWdBd0lCQWdJSUZuWlZ5ZWhtWFl3d0RRWUpLb1pJaHZjTkFRRU5CUUF3YmpFTE1Ba0dBMVVFQmhNQ1UwVXhIVEFiQmdOVkJBb01GRlJsYzNSaVlXNXJJRUVnUVVJZ0tIQjFZbXdwTVJVd0V3WURWUVFGRXd3eE1URXhNVEV4TVRFeE1URXhLVEFuQmdOVkJBTU1JRlJsYzNSaVlXNXJJRUVnUTBFZ2RqRWdabTl5SUVKaGJtdEpSQ0JVWlhOME1CNFhEVEV4TURreU1qRTBNakV4TkZvWERUTTBNVEl3TVRFME1qRXhORm93ZURFTE1Ba0dBMVVFQmhNQ1UwVXhIVEFiQmdOVkJBb01GRlJsYzNSaVlXNXJJRUVnUVVJZ0tIQjFZbXdwTVJVd0V3WURWUVFGRXd3eE1URXhNVEV4TVRFeE1URXhNekF4QmdOVkJBTU1LbFJsYzNSaVlXNXJJRUVnUTNWemRHOXRaWElnUTBFeElIWXhJR1p2Y2lCQ1lXNXJTVVFnVkdWemREQ0NBaUl3RFFZSktvWklodmNOQVFFQkJRQURnZ0lQQURDQ0Fnb0NnZ0lCQUlXMERQb3BMRWh0YXdWUndOckU0MzFHVnNoL0huV1ZzWGRnT2p6VXNEN1FEMzAvdGZPSFJPUWk5bkx1RFdrWTFmRVV4WjA2WXE1THRST29GcGtUUTZTUmkyUmdpVWt1Q05xTUV3c2oyZWlhN0toWVJJay9YSmtrRnAxQnZFNjJJNjN2dFV6WnpTNjlIQXNNTlBsZmRMVTJwSVoyQW5kMlFKMmRDMHhpbW1Galk1azUvejcvTmszSkdCYmF4TEgvWDZ6aGNOcU9wcjJTcnY5RytsaytHdnk3aFFMSW1OTFJWKzRHM21hbEhqNlFNK3dEY1JLdlQ0VitpUmR2elA5bzgwMy9nK0dMNXFpdWZXNlJkVCsybHdHaWZQMmQzc3VMNzl1R1cxSE84cWJpaS9pNEhUeERmdEtkWEZzbEZyWGZSKytRVVU0Qit2NlF5YjRyRjNxaERmZWFrZ2ZMOHV6ZnRNdFRNUmxvd3hJYjA4anhDZWhDU2FZMENNQkhRVFMwTHRYMUMvVmpNNlViYnBTYTI4MHpTTCt4WGxTN1M3MjdzSkI3MjJmeldSMy9OU3AzTVpUYkUwUUFxTVRFTlk0cGZ3Yy9sWHdWbjhUdkFOdzFGSXhFN2lrd0lCTUZTbzZlWDJVRER6OWFpNmR6UnJZZnRJNDRFdExUdjNLVjVVRFdjSWJzUkJ2bGdCUXFxdXBoY3VSVnYxYTZYbzl4ZUgyK28rQnNyK3NvdW1pQzZ6SUZ1VXVCeEI0dXFzU3FlVlFGa0lhZXBpbndoWDVDSkJaTGNPUmFNWkY2STFrR3ZFRFpPVllYT0V0OVBXZy9Tc1NjR00rc2YyNTEwR3owZjJvbVFqT0w1QmV6ZFlZS05Bd3ppejlVMUlyMVZwdnprSkY0U0EzVzA1Y21qaktaQWdNQkFBR2pkakIwTUIwR0ExVWREZ1FXQkJSZ2VuMm5XWU9NbjZTeEYrb05RME9WUSthWi9UQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01COEdBMVVkSXdRWU1CYUFGS1B5ZUhrZEswV0t5ZUhLbFFubG5tL095MDdGTUJFR0ExVWRJQVFLTUFnd0JnWUVLZ01FQlRBT0JnTlZIUThCQWY4RUJBTUNBUVl3RFFZSktvWklodmNOQVFFTkJRQURnZ0lCQUR4aHl6V1N6b2t5RytoVUNwM1VnN1FaeGJNTEsrNklZcCs4YWNSdVRTRmZyNW1hSDNNcnlkODcvQjJ5OUszZlcrRlhRTHBkaFZIb3ZLSk9BUXl2L3QzQ0E2MlpHcnpoQVhHcUNjUjlTbjQ0ZWNLUkpQRTlaSmJ6YWxvNHd0S1JVdjA0VzJaZ0Z1bllUTjU1VHNObjNiR3pjSWlBZGRNcTlUTUt3SWpsNnA1aTZvSWpBbXQ5Lzc1UWY3cVEvMXgyMEVVZHN2KzhRUElwMXZsQjh2QXpBdG8rOGJaRkNSc2RNVkxSUms5NkNvUzUzdjRhRFlZQU14bXNUYmd2THFWVTUvQ05mVkVnVmVTcEZWU3o2ZmxiRk1CWmQ1TE9QZ2xpL2xSSjdGV2V3UXZyWmFLZ2ZKZ2RtVVV2Q3BpMGVEKy9LQm5zRUpMYmhkbksvQitpVG80QTZCd29SKzlYaE9ReU5NVEIvU0R0U1ljekozNXZGaFpmS0o1LzBwc3FYU0pILzI1d0E0cGUvMzRFUnpRMW1nbGFkdDZKT2huV2Y5Mkp3NWpkdzdCRnB0ZzdsbUlrRHlZRFUrNlJ5RXNBckNpYkkrMjh5RjUvZkNaQ3VVZHdEdzlpSHBvb2RmMWg4dDFnZlBubm1rY3dHVGZQZy9kdVVna0Z3S1k5N1N6ZlpnUjAyaGQ3eHhvNXBLNzljemltTUYyR1RGdzlTV1NubFpLNzFmb1kyNUZ6U1VITm11R0hoRnpHOThBRkl0MFZMd2lUajh0SmVTalRpNDFpZjIzN3ZETnZzZXB0KzgvdHQ4MC9mNDVLelBOZldVQjA2L0ZHcjB3Zm9ZZ1pwNFBpOVJSVFh6RGFmd2o3cUxkdWFlcFJyTGNFVXBYV0NHcnVTVXlseHhDaGRCVHdWelpuPC9YNTA5Q2VydGlmaWNhdGU+PFg1MDlDZXJ0aWZpY2F0ZT5NSUlGMHpDQ0E3dWdBd0lCQWdJSVVZbWZkdHF0eTgwd0RRWUpLb1pJaHZjTkFRRU5CUUF3YlRFa01DSUdBMVVFQ2d3YlJtbHVZVzV6YVdWc2JDQkpSQzFVWld0dWFXc2dRa2xFSUVGQ01SOHdIUVlEVlFRTERCWkNZVzVyU1VRZ1RXVnRZbVZ5SUVKaGJtdHpJRU5CTVNRd0lnWURWUVFEREJ0VVpYTjBJRUpoYm10SlJDQlNiMjkwSUVOQklIWXhJRlJsYzNRd0hoY05NVEV3T1RJeU1UUXhOVEF6V2hjTk16UXhNak14TVRRd01UTXpXakJ1TVFzd0NRWURWUVFHRXdKVFJURWRNQnNHQTFVRUNnd1VWR1Z6ZEdKaGJtc2dRU0JCUWlBb2NIVmliQ2t4RlRBVEJnTlZCQVVURERFeE1URXhNVEV4TVRFeE1URXBNQ2NHQTFVRUF3d2dWR1Z6ZEdKaGJtc2dRU0JEUVNCMk1TQm1iM0lnUW1GdWEwbEVJRlJsYzNRd2dnSWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUNEd0F3Z2dJS0FvSUNBUUNUcVU3dXhrNVF6YlhTNkFyWElHVFdOZVpYejY1YnpkZ294Yjc5THZZaC9wN2tjSzI1bUEydHpHcE8zUVMxZUtKSnU4NEc5VU56bTRtTWw2Y25nblhjanhFVFlpRXF0aWpyQTVtZno4NjUvWDZVZ09wWDdEa291UThkNWVEeWhKNDlVckRxbHJnb1ZNeDMyMmtNMFNaNGhlVmVYODNlMUlTRml5eHFaQkt4aDI1eUtZRVpBNEV6SXJEajJ0aThDUnJXUEhDVFdhSUZwY2Q1VHlNaHBVVFBuNER6d1BoUEdXTVJOeGdPQWVQNEJTREI3UjZhejRyb3g3VFBrZDJzV0cxT0RqLzBJUlBoSlMxZFExQjdRaU5IWTU4UmpuTlRoRVFLd2RXV01QTUtQdGhTZCtHRWpMOUdEYWZZeE9zSXJLRll3bFlOQlczQzVtYmUzVCszaitBeGo2VzJIYmdtSlhQR0l0THVjeFkxa1B3VDlMN3U1bkl4YVJPbWgxdVR3WXFyOXB1R3E2c29KbmdnRVMzSzRQSWhNNmthbXZuQ0NQWG9xV0NDcnVTRVBWZ3lFWkVpMHNoeSs4MVFzZWIxZ2M5cllnVnJFbkxCT0l5TXFhVHRFeGFGcHJZYnYxZi9Bd1d0akZVaTJYaVNkTjhhTXAra3FiaSsxdEtKVVVQTEMrQ3JkdTlmRm8vOGxzbFNkZXcrU25QVkZlVno1Q09LYnQ2R1RFNHhjSmVSelc1d1EwdzdiK3JHTFdoSnZ3UkpzUzVHWHZxYTNMZzhFeVdpTEpzd3VURmFFd1BVRHZaQnZ5RlpFWmVydEtnWmJSWXZlem85L2dyd3lCK21vclZyTHJ5dTljaFlFWXdFNTUwdXp5S3R6WFV6eWdWOEZwWGU5RHBtcE9TZkdNQVVSUUlEQVFBQm8zWXdkREFkQmdOVkhRNEVGZ1FVby9KNGVSMHJSWXJKNGNxVkNlV2ViODdMVHNVd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZkJnTlZIU01FR0RBV2dCUks5Nk5xQ05vSU9CY1pVeWpJMnFiV05OaGF1akFSQmdOVkhTQUVDakFJTUFZR0JDb0RCQVV3RGdZRFZSMFBBUUgvQkFRREFnRUdNQTBHQ1NxR1NJYjNEUUVCRFFVQUE0SUNBUURQMURveGpFamV5RzI3eGVhaSttcHh4Sm9xQjFSRFZURVk4NlJkTnlsdVVLUU9JYmZLSk1tWCtEWDR2VHVVUVMzNTM5eHpIS3dwajZnaytpWlZqRjFVb0p0R3ArcXVyamphck9oNDRzKytzMHlXS2lLckpCRWxvSm44bytZWEZUOEM3ZTFXdHFKVm9hRmREQkN2b2hKeUsyMFBLUzcvblVHNWI3SjZpcTM1MTdZdmpiNEQ5NEx0MGRITlNnRDJCSUlIbU5rcFNZV2d5aTFzZWF2aE41QWp0ZkpyNHAxMDF1MlNzTmNMQXI0MkE1ZnJhbjl2TDI5SGphTTJNVFU4TDBPeG9JWDhsZ2NwVXk5d2NpN2xIUUtPaXdhT2NJS2ZDQzFxTTdsTzV6MGM0UCtvMHpUNjE4M3hKVjNybXcyMkdHWWQ0MEVCcVc5N29xQkswSWorS2w1c3V5Y1o0SjJxSzFhVmNpWUJac0JObGJ0bXovazhIdUJ4eTlXYkVlUHNZLzYxSTUwZkJMU0FrVmsvVGVhNGorTk5ISjFpbXA3Qm8xOGFMbzhwbGI5ZTJpWmVJRHpIMXU2Nm8wUkZZYkhkbkpEOENuUGVCTFZnU3ZFcW1CUzExZmdIcjgxL3RrNWxKeGNLZWpkc0VmdHpHUXh3dUh3L3Bqa2pvYklreHJyb1hwYTZpWG9rVnlINGJlMTYrZi9kRGFFa2g5UmY4TGgxVUVRUHh4cEN5SVNNaWZINXBMNzhES2hHbmg4VmZpN0Vlc1VWMWs2WTNlVkNGdzJDQ0tXY3ZYc0piOVFxTEZzRHFJbFdQaDZiQmdNNGFYZnBlMGFyRHJnWVJiYng4TDZvdWh5eEFId2p0ejlpMGxYZXpXTVg1ZjdRWVJFTVRDNXlCUE5UVFAyZkNOc296UT09PC9YNTA5Q2VydGlmaWNhdGU+PC9YNTA5RGF0YT48L0tleUluZm8+PE9iamVjdD48YmFua0lkU2lnbmVkRGF0YSB4bWxucz0iaHR0cDovL3d3dy5iYW5raWQuY29tL3NpZ25hdHVyZS92MS4wLjAvdHlwZXMiIElkPSJiaWRTaWduZWREYXRhIj48dXNyVmlzaWJsZURhdGEgY2hhcnNldD0iVVRGLTgiIHZpc2libGU9Ind5c2l3eXMiPmMybG5ibVZ5YVc1bmMzUmxlSFE9PC91c3JWaXNpYmxlRGF0YT48dXNyTm9uVmlzaWJsZURhdGE+WldvZ2MzbHViR2xuPC91c3JOb25WaXNpYmxlRGF0YT48c3J2SW5mbz48bmFtZT5ZMjQ5Um1sdVlXNXphV1ZzYkNCSlJDMVVaV3R1YVdzZ1FrbEVJRUZDTEc1aGJXVTlWR1Z6ZENCaGRpQkNZVzVyU1VRc2MyVnlhV0ZzVG5WdFltVnlQVFUxTmpZek1EUTVNamdzYnoxVVpYTjBZbUZ1YXlCQklFRkNJQ2h3ZFdKc0tTeGpQVk5GPC9uYW1lPjxub25jZT50eFhnUEMvQ2VleGttbHpJMC9aUG5ZNXk2bFE9PC9ub25jZT48ZGlzcGxheU5hbWU+VkdWemRDQmhkaUJDWVc1clNVUT08L2Rpc3BsYXlOYW1lPjwvc3J2SW5mbz48Y2xpZW50SW5mbz48ZnVuY0lkPklkZW50aWZpY2F0aW9uPC9mdW5jSWQ+PHZlcnNpb24+VUdWeWMyOXVZV3c5Tnk0eE1pNHhMalVtUW1GdWEwbEVYMlY0WlQwM0xqRXlMakV1TlNaQ1NWTlFQVGN1TVRJdU1TNDFKbkJzWVhSbWIzSnRQVzFoWTI5emVDWnZjMTkyWlhKemFXOXVQVEV5TGpVbVpHbHpjR3hoZVY5MlpYSnphVzl1UFNaMWFHazlaMmxEYzFWelZsbG5Xa1ZuT1RaUUwyd3ZOMUZKZUZkcWRYTnhWeVpzWldkaFkzbDFhR2s5WjJsRGMxVnpWbGxuV2tWbk9UWlFMMnd2TjFGSmVGZHFkWE54VnlaaVpYTjBYMkpsWm05eVpUMHhOalkxTWpFM056STBKZz09PC92ZXJzaW9uPjxlbnY+PGFpPjx0eXBlPlQxTmZXQT09PC90eXBlPjxkZXZpY2VJbmZvPk1USXVOUT09PC9kZXZpY2VJbmZvPjx1aGk+Z2lDc1VzVllnWkVnOTZQL2wvN1FJeFdqdXNxVzwvdWhpPjxmc2liPjA8L2ZzaWI+PHV0Yj5jczE8L3V0Yj48cmVxdWlyZW1lbnQ+PGNvbmRpdGlvbj48dHlwZT5DZXJ0aWZpY2F0ZVBvbGljaWVzPC90eXBlPjx2YWx1ZT4xLjIuMy40LjU8L3ZhbHVlPjwvY29uZGl0aW9uPjwvcmVxdWlyZW1lbnQ+PHVhdXRoPnB3PC91YXV0aD48L2FpPjwvZW52PjwvY2xpZW50SW5mbz48L2JhbmtJZFNpZ25lZERhdGE+PC9PYmplY3Q+PC9TaWduYXR1cmU+';

    public function test_it_fails_if_no_session_transaction()
    {
        $rule = new SignCompleted('signeringstext');

        $this->assertFalse($rule->passes('transactionId', '123'));
    }

    public function test_it_fails_if_session_transaction_id_does_not_match_given()
    {
        $transaction = new BankIDTransaction(
            'orderInfo123',
            '67df3917-fa0d-44e5-b327-edcc928297f8',
            'd28db9a7-4cde-429e-a983-359be676944c',
            'autoStartToken'
        );

        BankID::setSessionTransaction($transaction);

        $rule = new SignCompleted('signeringstext');

        $this->assertFalse($rule->passes('transactionId', 'fakeTransactionId'));
    }

    public function test_it_passes_given_a_completed_sign_transaction()
    {
        $transaction = new BankIDTransaction(
            'orderInfo123',
            '67df3917-fa0d-44e5-b327-edcc928297f8',
            'd28db9a7-4cde-429e-a983-359be676944c',
            'autoStartToken'
        );

        $collectResponse = new CollectResponse();
        $collectResponse->setOrderRef('orderInfo123');
        $collectResponse->setStatus('complete');
        $collectResponse->setHintCode('hintCode');

        $completionData = new CompletionData();
        $completionData->setSignature($this->signature);

        $collectResponse->setCompletionData($completionData);

        $transaction->setLastCollectResponse($collectResponse);

        BankID::setSessionTransaction($transaction);

        $rule = new SignCompleted('signeringstext');

        $this->assertTrue($rule->passes('transactionId', $transaction->getTransactionId()));
    }
}
